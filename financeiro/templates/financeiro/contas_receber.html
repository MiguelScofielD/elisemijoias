{% extends "base.html" %}
{% block title %}Contas a Receber{% endblock %}

{% block content %}
<h1>Contas a Receber</h1>

<div class="mb-3">
    <a href="?status=todas" class="btn btn-outline-dark">Todas</a>
    <a href="?status=pendentes" class="btn btn-outline-warning">Pendentes</a>
    <a href="?status=atrasadas" class="btn btn-outline-danger">Atrasadas</a>
</div>

<table class="table table-striped align-middle">
    <thead>
        <tr>
            <th>Cliente</th>
            <th>Venda</th>
            <th>Valor Total</th>
            <th>Vencimento</th>
            <th>Status</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for conta in contas %}
        <tr>
            <!-- CLIENTE (COM LINK PARA HISTÓRICO) -->
            <td>
                {% if conta.venda.cliente %}
                    <a href="{% url 'financeiro:historico_cliente' conta.venda.cliente.id %}">
                        {{ conta.venda.cliente.nome }}
                    </a>
                {% else %}
                    Consumidor Final
                {% endif %}
            </td>

            <!-- VENDA -->
            <td>#{{ conta.venda.id }}</td>

            <!-- VALOR TOTAL -->
            <td>R$ {{ conta.valor }}</td>

            <!-- VENCIMENTO -->
            <td>{{ conta.vencimento|date:"d/m/Y" }}</td>

            <!-- STATUS (BASEADO NO SALDO) -->
            <td>
                {% if conta.saldo > 0 %}
                    <span class="badge bg-warning text-dark">Em aberto</span>
                {% else %}
                    <span class="badge bg-success">Paga</span>
                {% endif %}
            </td>

            <!-- AÇÕES -->
            <td>
                {% if conta.saldo > 0 %}
                    <a href="{% url 'financeiro:pagar_conta' conta.id %}"
                       class="btn btn-sm btn-success">
                        Pagar
                    </a>
                {% else %}
                    ✔
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="text-center">
                Nenhuma conta encontrada.
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
